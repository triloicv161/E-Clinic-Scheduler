{% extends "base.html" %}

{% block title %}Chi ti·∫øt b√°c sƒ©{% endblock %}
{% block searchbar %}{% endblock %}
{% block content %}
<div class="container my-5">
  <div class="row g-4">
    <!-- C·ªôt tr√°i: Th√¥ng tin b√°c sƒ© -->
    <div class="col-lg-4">
      <div class="card shadow-sm p-3">
        <div class="text-center">
          <!-- ·∫¢nh b√°c sƒ© -->
          <img src="{{ doctor.image_url or url_for('static', filename='default_doctor.png') }}" 
               alt="{{ doctor.tenBacSi }}" 
               class="rounded-circle mb-3 doctor-img"
               style="width:120px;height:120px;object-fit:cover;">
          
          <h4>{{ doctor.tenBacSi }}</h4>
          <p class="text-muted">{{ doctor.chuyenKhoa }}</p>
          {% if doctor.kinhNghiem %}
            <span class="badge bg-primary">{{ doctor.kinhNghiem }} nƒÉm kinh nghi·ªám</span>
          {% endif %}
          {% if doctor.diaChiPhongKham %}
            <span class="badge bg-secondary">{{ doctor.diaChiPhongKham }}</span>
          {% endif %}
        </div>
        <hr>
        
        <!-- Gi·ªõi thi·ªáu -->
        <h6>üë®‚Äç‚öïÔ∏è Gi·ªõi thi·ªáu</h6>
        <p>{{ doctor.description or "Ch∆∞a c√≥ th√¥ng tin." }}</p>

        <!-- Tr√¨nh ƒë·ªô h·ªçc v·∫•n -->
        <h6>üéì Tr√¨nh ƒë·ªô h·ªçc v·∫•n</h6>
        <ul>
          {% if doctor.education %}
            {% for hv in doctor.education.split(";") %}
              <li>{{ hv }}</li>
            {% endfor %}
          {% else %}
            <li>ƒêang c·∫≠p nh·∫≠t</li>
          {% endif %}
        </ul>

        <!-- Ch·ª©ng ch·ªâ -->
        <h6>üìú B·∫±ng c·∫•p & Ch·ª©ng ch·ªâ</h6>
        <ul>
          {% if doctor.certifications %}
            {% for cert in doctor.certifications.split(";") %}
              <li>{{ cert }}</li>
            {% endfor %}
          {% else %}
            <li>Ch∆∞a c√≥ d·ªØ li·ªáu</li>
          {% endif %}
        </ul>

        <!-- Ch·ª©c v·ª• -->
        {% if doctor.chucVu %}
          <h6>üíº Ch·ª©c v·ª•</h6>
          <p>{{ doctor.chucVu }}</p>
        {% endif %}
      </div>
    </div>

    <!-- C·ªôt ph·∫£i: ƒê√°nh gi√° + L·ªãch l√†m vi·ªác -->
    <div class="col-lg-8">
      <!-- ƒê√°nh gi√° -->
      <div class="card shadow-sm p-3 mb-4">
        <h5>‚≠ê ƒê√°nh gi√° t·ª´ b·ªánh nh√¢n</h5>
        <h6 class="text-warning">ƒêi·ªÉm trung b√¨nh: {{ avg_rating or 0 }} / 5</h6>
        {% for review in reviews %}
          <div class="border rounded p-2 mb-2">
            <strong>{{ review.patient_name }}</strong> - {{ review.date }}
            <p>{{ review.comment }}</p>
            <span class="text-warning">{{ "‚≠ê" * review.rating }}</span>
          </div>
        {% else %}
          <p class="text-muted">Ch∆∞a c√≥ ƒë√°nh gi√° n√†o.</p>
        {% endfor %}
      </div>

      <!-- L·ªãch l√†m vi·ªác -->
      <div class="mt-5">
        <h4>L·ªãch l√†m vi·ªác</h4>
        <div class="d-flex justify-content-center align-items-center my-3">
          <a href="{{ url_for('doctor_detail', doctor_id=doctor.idBacSi, week_start=prev_week) }}" 
             class="btn btn-outline-secondary me-3">&lt;</a>

          <span>{{ week_label }}</span>

          <a href="{{ url_for('doctor_detail', doctor_id=doctor.idBacSi, week_start=next_week) }}" 
             class="btn btn-outline-secondary ms-3">&gt;</a>
        </div>
        <table class="table table-bordered text-center align-middle">
          <thead class="table-light">
            <tr>
              <th>Gi·ªù</th>
              {% for d in days %}
                <th>{{ d.strftime('%a %d/%m') }}</th>
              {% endfor %}
            </tr>
          </thead>
          <tbody>
            {% for h in hours %}
            <tr>
              <td><strong>{{ "%02d:00"|format(h) }}</strong></td>
              {% for d in days %}
                {% if schedule_map.get(d) and h in schedule_map[d] %}
                  <td class="bg-secondary text-white">B·∫≠n</td>
                {% else %}
                  <td></td>
                {% endif %}
              {% endfor %}
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>
{% endblock %}
